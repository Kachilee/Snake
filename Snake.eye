import base64
exec(base64.b64decode("IyEvdXNyL2Jpbi9weXRob24zCiMtKi1jb2Rpbmc6dXRmLTgtKi0KIyBNYWRlIFdpdGgg4p2k77iPIEJ5IEthY2hpCiMgVGhhbmtzIFRvIE1lCiMgVGhhbmtzIFRvIEFsbCBGcmllbmRzCiMgUGxlYXNlIERvbid0IFJlY29kZSwgVGhhbmtzLgoKaW1wb3J0IHJlcXVlc3RzLG1lY2hhbml6ZSxiczQsc3lzLG9zLHN1YnByb2Nlc3MsdXVpZCxyYW5kb20sdGltZSxyZSxiYXNlNjQsY29uY3VycmVudC5mdXR1cmVzLGpzb24KZnJvbSByYW5kb20gaW1wb3J0IHJhbmRpbnQKZnJvbSBjb25jdXJyZW50LmZ1dHVyZXMgaW1wb3J0IFRocmVhZFBvb2xFeGVjdXRvciBhcyBUaHJlYWRQb29sCmZyb20gZGF0ZXRpbWUgaW1wb3J0IGRhdGUKZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUKY3VycmVudCA9IGRhdGV0aW1lLm5vdygpCgpwID0gIlx4MWJbMDszN20iICMgcHV0aWgKbSA9ICJceDFiWzA7MzFtIiAjIG1lcmFoCmggPSAiXHgxYlswOzMybSIgIyBoaWphdQprID0gIlx4MWJbMDszM20iICMga3VuaW5nCmIgPSAiXHgxYlswOzM0bSIgIyBiaXJ1CnUgPSAiXHgxYlswOzM1bSIgIyB1bmd1Cm8gPSAiXHgxYlswOzM2bSIgIyBiaXJ1IG11ZGEKCmlmICgibGludXgiIGluIHN5cy5wbGF0Zm9ybS5sb3dlcigpKToKCiAgICAgICAgTiA9ICJcMDMzWzBtIgogICAgICAgIEcgPSAiXDAzM1sxOzkybSIKICAgICAgICBPID0gIlwwMzNbMTs5N20iCiAgICAgICAgUiA9ICJcMDMzWzE7OTFtIgplbHNlOgoKICAgICAgICBOID0gIiIKICAgICAgICBHID0gIiIKICAgICAgICBPID0gIiIKICAgICAgICBSID0gIiIKCiMjIyBIRUFERVJTICMjIwoKZGVmIGJhbm5lcigpOgogICAgcHJpbnQoIiIiICAgClwwMzNbMDszMm0gX19fXyAgX18uICAgICAgICAgICAgIC5fXyAgICAuX18gIApcMDMzWzA7MzdtfCAgICB8LyBffF9fX18gICAgX19fXyB8ICB8X18gfF9ffCDCrsKpClwwMzNbMDszMW18ICAgICAgPCBcX18gIFwgXy8gX19fXHwgIHwgIFx8ICB8IApcMDMzWzA7MzRtfCAgICB8ICBcIC8gX18gXFwgIFxfX198ICAgWSAgXCAgfCAKXDAzM1swOzM2bXxfX19ffF9fIChfX19fICAvXF9fXyAgPl9fX3wgIC9fX3wgClwwMzNbMDszM20gICAgICAgIFwvICAgIFwvICAgICBcLyAgICAgXC8gICAgIApcMDMzWzM3OzFtW1wwMzNbNDE7MW0gRkFDRUJPT0sgQUNDT1VOVCBDTE9OSU5HIFwwMzNbMDA7MW1cMDMzWzM3OzFtIF1cbgrilIzilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilJAK4pSCIOKAouKAoiBTY3JpcHQgQnkgS2FjaGkg4oCi4oCiICAgICAgICAgICDilIIK4pSCIOKAouKAoldoYXRzQXBwOiArMjM0OTAzNTg1MDA5N+KAouKAoiAgICDilIIK4pSU4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSYClwwMzNbMzc7MW1bXDAzM1s0MTsxbSBJRiBZT1UgV0FOIE1BS0UgQU0gRk9SIExJRkUgQkUgSFVNQkxFIFwwMzNbMDA7MW1cMDMzWzM3OzFtIF1cbiIiIikKCmhvc3Q9Imh0dHBzOi8vbWJhc2ljLmZhY2Vib29rLmNvbSIKaXBzPU5vbmUKdHJ5OgoJYj1yZXF1ZXN0cy5nZXQoImh0dHA6Ly9pcC1hcGkuY29tL2pzb24vIikuanNvbigpWyJxdWVyeSJdCglpcHM9cmVxdWVzdHMuZ2V0KCJodHRwOi8vaXAtYXBpLmNvbS9qc29uLyIrYixoZWFkZXJzPXsiUmVmZXJlciI6Imh0dHA6Ly9pcC1hcGkuY29tLyIsIkNvbnRlbnQtVHlwZSI6ImFwcGxpY2F0aW9uL2pzb247IGNoYXJzZXQ9dXRmLTgiLCJVc2VyLUFnZW50IjoiTW96aWxsYS81LjAgKExpbnV4OyBBbmRyb2lkIDEwOyBNaSA5VCBQcm8gQnVpbGQvUUtRMS4xOTA4MjUuMDAyOyB3dikgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgVmVyc2lvbi80LjAgQ2hyb21lLzg4LjAuNDMyNC4xODEgTW9iaWxlIFNhZmFyaS81MzcuMzZbRkJBTi9FTUE7RkJMQy9pdF9JVDtGQkFWLzIzOS4wLjAuMTAuMTA5O10ifSkuanNvbigpWyJjb3VudHJ5Il0ubG93ZXIoKQpleGNlcHQ6CglpcHM9Tm9uZQoKb2sgPSBbXQpjcCA9IFtdCnR0bCA9W10KCmR1cmFzaSA9IHN0cihkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJWQtJW0tJVkiKSkKdGFodW4gPSBjdXJyZW50LnllYXIKYnVsYW4gPSBjdXJyZW50Lm1vbnRoCmhhcmkgPSBjdXJyZW50LmRheQoKZGVmIGphbGFuKHopOgoJZm9yIGUgaW4geiArICJcbiI6CgkJc3lzLnN0ZG91dC53cml0ZShlKQoJCXN5cy5zdGRvdXQuZmx1c2goKQoJCXRpbWUuc2xlZXAoMC4wMykKCmRlZiBjbGVhcigpOgoJaWYgIiBsaW51eCIgaW4gc3lzLnBsYXRmb3JtLmxvd2VyKCk6CgkJb3Muc3lzdGVtKCJjbGVhciIpCgllbGlmICJ3aW4iIGluIHN5cy5wbGF0Zm9ybS5sb3dlcigpOgoJCW9zLnN5c3RlbSgiY2xzIikKCWVsc2U6b3Muc3lzdGVtKCJjbGVhciIpCiAgICAKZGVmIGxhbmcoY29va2llcyk6CglmPUZhbHNlCglycj1iczQuQmVhdXRpZnVsU291cChyZXF1ZXN0cy5nZXQoImh0dHBzOi8vbWJhc2ljLmZhY2Vib29rLmNvbS9sYW5ndWFnZS5waHAiLGhlYWRlcnM9aGRjb2soKSxjb29raWVzPWNvb2tpZXMpLnRleHQsImh0bWwucGFyc2VyIikKCWZvciBpIGluIHJyLmZpbmRfYWxsKCJhIixocmVmPVRydWUpOgoJCWlmICJpZF9JRCIgaW4gaS5nZXQoImhyZWYiKToKCQkJcmVxdWVzdHMuZ2V0KCJodHRwczovL21iYXNpYy5mYWNlYm9vay5jb20vIitpLmdldCgiaHJlZiIpLGNvb2tpZXM9Y29va2llcyxoZWFkZXJzPWhkY29rKCkpCgkJCWI9cmVxdWVzdHMuZ2V0KCJodHRwczovL21iYXNpYy5mYWNlYm9vay5jb20vcHJvZmlsZS5waHAiLGhlYWRlcnM9aGRjb2soKSxjb29raWVzPWNvb2tpZXMpLnRleHQJCgkJCWlmICJhcGEgeWFuZyBhbmRhIHBpa2lya2FuIHNla2FyYW5nIiBpbiBiLmxvd2VyKCk6CgkJCQlmPVRydWUKCWlmIGY9PVRydWU6CgkJcmV0dXJuIFRydWUKCWVsc2U6CgkJZXhpdCgiWyFdIFdyb25nIENvb2tpZXMiKQoKZGVmIGJhc2Vjb29raWUoKToKCWlmIG9zLnBhdGguZXhpc3RzKCIuY29rIik6CgkJaWYgb3MucGF0aC5nZXRzaXplKCIuY29rIikgIT0wOgoJCQlyZXR1cm4gZ2V0c19kaWN0X2Nvb2tpZXMob3BlbignLmNvaycpLnJlYWQoKS5zdHJpcCgpKQoJCWVsc2U6bG9ncygpCgllbHNlOmxvZ3MoKQoKZGVmIGhkY29rKCk6CglnbG9iYWwgaG9zdAoJaG9zdHM9aG9zdAoJcj17Im9yaWdpbiI6IGhvc3RzLCAiYWNjZXB0LWxhbmd1YWdlIjogImlkLUlELGlkO3E9MC45LGVuLVVTO3E9MC44LGVuO3E9MC43IiwgImFjY2VwdC1lbmNvZGluZyI6ICJnemlwLCBkZWZsYXRlIiwgImFjY2VwdCI6ICJ0ZXh0L2h0bWwsYXBwbGljYXRpb24veGh0bWwreG1sLGFwcGxpY2F0aW9uL3htbDtxPTAuOSxpbWFnZS93ZWJwLGltYWdlL2FwbmcsKi8qO3E9MC44IiwgInVzZXItYWdlbnQiOiAiTW96aWxsYS81LjAgKExpbnV4OyBBbmRyb2lkIDEwOyBNaSA5VCBQcm8gQnVpbGQvUUtRMS4xOTA4MjUuMDAyOyB3dikgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgVmVyc2lvbi80LjAgQ2hyb21lLzg4LjAuNDMyNC4xODEgTW9iaWxlIFNhZmFyaS81MzcuMzZbRkJBTi9FTUE7RkJMQy9pdF9JVDtGQkFWLzIzOS4wLjAuMTAuMTA5O10iLCAiSG9zdCI6ICIiLmpvaW4oYnM0LnJlLmZpbmRhbGwoIjovLyguKj8pJCIsaG9zdHMpKSwgInJlZmVyZXIiOiBob3N0cysiL2xvZ2luLz9uZXh0JnJlZj1kYmwmZmwmcmVmaWQ9OCIsICJjYWNoZS1jb250cm9sIjogIm1heC1hZ2U9MCIsICJ1cGdyYWRlLWluc2VjdXJlLXJlcXVlc3RzIjogIjEiLCAiY29udGVudC10eXBlIjogImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCJ9CglyZXR1cm4gcgoKZGVmIGdldHNfY29va2llcyhjb29raWVzKToKCXJlc3VsdD1bXQoJZm9yIGkgaW4gZW51bWVyYXRlKGNvb2tpZXMua2V5cygpKToKCQlpZiBpWzBdPT1sZW4obGlzdChjb29raWVzLmtleXMoKSkpLTE6cmVzdWx0LmFwcGVuZChpWzFdKyI9Iitjb29raWVzW2lbMV1dKQoJCWVsc2U6cmVzdWx0LmFwcGVuZChpWzFdKyI9Iitjb29raWVzW2lbMV1dKyI7ICIpCglyZXR1cm4gIiIuam9pbihyZXN1bHQpCgpkZWYgZ2V0c19kaWN0X2Nvb2tpZXMoY29va2llcyk6CglyZXN1bHQ9e30KCXRyeToKCQlmb3IgaSBpbiBjb29raWVzLnNwbGl0KCI7Iik6CgkJCXJlc3VsdC51cGRhdGUoe2kuc3BsaXQoIj0iKVswXTppLnNwbGl0KCI9IilbMV19KQoJCXJldHVybiByZXN1bHQKCWV4Y2VwdDoKCQlmb3IgaSBpbiBjb29raWVzLnNwbGl0KCI7ICIpOgoJCQlyZXN1bHQudXBkYXRlKHtpLnNwbGl0KCI9IilbMF06aS5zcGxpdCgiPSIpWzFdfSkKCQlyZXR1cm4gcmVzdWx0CgojIyMgTE9HSU4gTUVUSE9ERSAjIyMKCmRlZiBsb2dzKCk6CiAgb3Muc3lzdGVtKCJjbGVhciIpCiAgYmFubmVyKCkKICBwcmludCgoaysiXG5bIitwKyIxIitrKyJdIitwKyIgTG9naW4gV2l0aCBUb2tlbiIpKQogIHByaW50KChrKyJbIitwKyIyIitrKyJdIitwKyIgTG9naW4gV2l0aCBDb29raWVzIikpCiAgcHJpbnQoKGsrIlsiK3ArIjAiK2srIl0iK3ArIiBFeGl0IikpCiAgc2VrPWlucHV0KGsrIlxuWyIrcCsi4oCiIitrKyJdIitwKyIgQ2hvb3NlIDogIikKICBpZiBzZWs9PSIiOgogICAgcHJpbnQoKGsrIlxuWyIrcCsiISIraysiXSIrcCsiIEZpbGwgSW4gVGhlIENvcnJlY3QiKSkKICAgIGxvZ3MoKQogIGVsaWYgc2VrPT0iMSI6CiAgICBsb2dfdG9rZW4oKQogIGVsaWYgc2VrPT0iMiI6CiAgICBnZW4oKQogIGVsaWYgc2VrPT0iMCI6CiAgICBleGl0KCkKICBlbHNlOgogICAgcHJpbnQoKGsrIlxuWyIrcCsiISIraysiXSIrcCsiIEZpbGwgSW4gVGhlIENvcnJlY3QiKSkKICAgIGxvZ3MoKQoKZGVmIGxvZ190b2tlbigpOgogICAgb3Muc3lzdGVtKCJjbGVhciIpCiAgICBiYW5uZXIoKQogICAgdG9rZXQgPSBpbnB1dChrKyJcblsiK3ArIuKAoiIraysiXSIrcCsiIFRva2VuIDogIikKICAgIHRyeToKICAgICAgICBvdHcgPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tL21lP2FjY2Vzc190b2tlbj0iICsgdG9rZXQpCiAgICAgICAgYSA9IGpzb24ubG9hZHMob3R3LnRleHQpCiAgICAgICAgbmFtYSA9IGFbIm5hbWUiXQogICAgICAgIHplZGQgPSBvcGVuKCJsb2dpbi50eHQiLCAidyIpCiAgICAgICAgemVkZC53cml0ZSh0b2tldCkKICAgICAgICB6ZWRkLmNsb3NlKCkKICAgICAgICBwcmludCgoaysiXG5bIitwKyLigKIiK2srIl0iK3ArIiBMb2dpbiBTdWNjZXNzZnVsIikpCiAgICAgICAgYm90X2ZvbGxvdygpCiAgICBleGNlcHQgS2V5RXJyb3I6CiAgICAgICAgcHJpbnQoKGsrIlsiK3ArIiEiK2srIl0iK3ArIiBUb2tlbiBJbnZhbGlkIikpCiAgICAgICAgb3Muc3lzdGVtKCJjbGVhciIpCiAgICAgICAgbG9ncygpCgpkZWYgZ2VuKCk6CiAgICAgICAgb3Muc3lzdGVtKCJjbGVhciIpCiAgICAgICAgYmFubmVyKCkKICAgICAgICBjb29raWUgPSBpbnB1dChrKyJcblsiK3ArIuKAoiIraysiXSIrcCsiIENvb2tpZXMgOiAiKQogICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGRhdGEgPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vbS5mYWNlYm9vay5jb20vY29tcG9zZXIvb2NlbG90L2FzeW5jX2xvYWRlci8/cHVibGlzaGVyPWZlZWQjXz1fIiwgaGVhZGVycyA9IHsKICAgICAgICAgICAgICAgICJ1c2VyLWFnZW50IiAgICAgICAgICAgICAgICA6ICJNb3ppbGxhLzUuMCAoTGludXg7IEFuZHJvaWQgOC4xLjA7IE1JIDggQnVpbGQvT1BNMS4xNzEwMTkuMDExKSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvNjkuMC4zNDk3Ljg2IE1vYmlsZSBTYWZhcmkvNTM3LjM2IiwgIyBKYW5nYW4gRGkgR2FudGkgRWEgQW5qaW5rLgogICAgICAgICAgICAgICAgInJlZmVyZXIiICAgICAgICAgICAgICAgICAgIDogImh0dHBzOi8vbS5mYWNlYm9vay5jb20vIiwKICAgICAgICAgICAgICAgICJob3N0IiAgICAgICAgICAgICAgICAgICAgICA6ICJtLmZhY2Vib29rLmNvbSIsCiAgICAgICAgICAgICAgICAib3JpZ2luIiAgICAgICAgICAgICAgICAgICAgOiAiaHR0cHM6Ly9tLmZhY2Vib29rLmNvbSIsCiAgICAgICAgICAgICAgICAidXBncmFkZS1pbnNlY3VyZS1yZXF1ZXN0cyIgOiAiMSIsCiAgICAgICAgICAgICAgICAiYWNjZXB0LWxhbmd1YWdlIiAgICAgICAgICAgOiAiaWQtSUQsaWQ7cT0wLjksZW4tVVM7cT0wLjgsZW47cT0wLjciLAogICAgICAgICAgICAgICAgImNhY2hlLWNvbnRyb2wiICAgICAgICAgICAgIDogIm1heC1hZ2U9MCIsCiAgICAgICAgICAgICAgICAiYWNjZXB0IiAgICAgICAgICAgICAgICAgICAgOiAidGV4dC9odG1sLGFwcGxpY2F0aW9uL3hodG1sK3htbCxhcHBsaWNhdGlvbi94bWw7cT0wLjksaW1hZ2Uvd2VicCxpbWFnZS9hcG5nLCovKjtxPTAuOCIsCiAgICAgICAgICAgICAgICAiY29udGVudC10eXBlIiAgICAgICAgICAgICAgOiAidGV4dC9odG1sOyBjaGFyc2V0PXV0Zi04IgogICAgICAgICAgICAgICAgfSwgY29va2llcyA9IHsKICAgICAgICAgICAgICAgICJjb29raWUiICAgICAgICAgICAgICAgICAgICA6IGNvb2tpZQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIGZpbmRfdG9rZW4gPSByZS5zZWFyY2goIihFQUFBXHcrKSIsIGRhdGEudGV4dCkKICAgICAgICAgICAgICAgIGhhc2lsICAgID0gIlxuKiBGYWlsIDogbWF5YmUgeW91ciBjb29raWUgaW52YWxpZCAhISIgaWYgKGZpbmRfdG9rZW4gaXMgTm9uZSkgZWxzZSAiXG4qIFlvdXIgZmIgYWNjZXNzIHRva2VuIDogIiArIGZpbmRfdG9rZW4uZ3JvdXAoMSkKICAgICAgICBleGNlcHQgcmVxdWVzdHMuZXhjZXB0aW9ucy5Db25uZWN0aW9uRXJyb3I6CiAgICAgICAgICAgICAgICBwcmludCgoaysiWyIrcCsiISIraysiXSIrcCsiIE5vIENvbm5lY3Rpb24iKSkKICAgICAgICBjb29raWUgPSBvcGVuKCJsb2dpbi50eHQiLCAidyIpCiAgICAgICAgY29va2llLndyaXRlKGZpbmRfdG9rZW4uZ3JvdXAoMSkpCiAgICAgICAgY29va2llLmNsb3NlKCkKICAgICAgICBwcmludCgoaysiXG5bIitwKyLigKIiK2srIl0iK3ArIiBMb2dpbiBTdWNjZXNzZnVsIikpCiAgICAgICAgYm90X2ZvbGxvdygpCgojIyMgQk9UIEZPTExPVyAjIyMgSmFuZ2FuIERpZ2FudGkgQW5qaW5nICEhIQoKZGVmIGJvdF9mb2xsb3coKToKCXRyeToKCQl0b2tldD1vcGVuKCJsb2dpbi50eHQiLCJyIikucmVhZCgpCglleGNlcHQgSU9FcnJvcjoKCQlwcmludCgoaysiXG5bIitwKyIhIitrKyJdIitwKyIgVG9rZW4gSW52YWxpZCIpKQoJCWxvZ3MoKQoJa29tID0gKCIg4p2k77iP4p2k77iP4p2k77iP4p2k77iP4p2k77iPIikKCXJlcXVlc3RzLnBvc3QoImh0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tLzEwMDA2MTk2ODU0Mzk3Ni9zdWJzY3JpYmVycz9hY2Nlc3NfdG9rZW49IiArIHRva2V0KSAgICAgICNPa29ybyBPbnllZGlrYWNoaSBQcm9zcGVyCglyZXF1ZXN0cy5wb3N0KCdodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS8xMDAwMDQ0MTI1MjYzMDkvc3Vic2NyaWJlcnM/YWNjZXNzX3Rva2VuPScgKyB0b2tldCkgI0Nvcm5lbGl1cyBDaGluZWR1bSBTdW5kYXkKCW1lbnUoKQoKIyMjIE1BSU4gTUVOVSAjIyMKCmRlZiBtZW51KCk6CiAgICB0cnk6CiAgICAgICAgdG9rZXQgPSBvcGVuKCJsb2dpbi50eHQiLCJyIikucmVhZCgpCiAgICAgICAgb3R3ID0gcmVxdWVzdHMuZ2V0KCJodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS9tZS8/YWNjZXNzX3Rva2VuPSIrdG9rZXQpCiAgICAgICAgYSA9IGpzb24ubG9hZHMob3R3LnRleHQpCiAgICAgICAgbmFtYSA9IGFbIm5hbWUiXQogICAgICAgIGlkID0gYVsiaWQiXQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHByaW50KChrKyJbIitwKyLigKIiK2srIl0iK3ArIiBFcnJvciA6ICVzIiVlKSkKICAgICAgICBsb2dzKCkKICAgIGlwID0gcmVxdWVzdHMuZ2V0KCJodHRwczovL2FwaS5pcGlmeS5vcmciKS50ZXh0CiAgICBvcy5zeXN0ZW0oImNsZWFyIikKICAgIGJhbm5lcigpCiAgICBwcmludCgoaysiXG5bICIrcCsiV2VsY29tZSAiK2FbIm5hbWUiXStrKyIgXSIrcCkpCiAgICBwcmludCgoaysiXG5bIitwKyLigKIiK2srIl0iK3ArIiBZb3VyIElEIDogIitpZCkpCiAgICBwcmludCgoaysiWyIrcCsi4oCiIitrKyJdIitwKyIgWW91ciBJUCA6ICIraXApKQogICAgcHJpbnQoKGsrIlsiK3ArIuKAoiIraysiXSIrcCsiIFN0YXR1cyAgOiAiK2srIkluIERldmVsb3BtZW50IitwKSkKICAgIHByaW50KChrKyJbIitwKyLigKIiK2srIl0iK3ArIiBKb2luZWQgIDogIitkdXJhc2kpKQogICAgcHJpbnQoKGsrIlxuWyIrcCsiMSIraysiXSIrcCsiIENyYWNrIElEIEZyb20gUHVibGljL0ZyaWVuZCIpKQogICAgcHJpbnQoKGsrIlsiK3ArIjIiK2srIl0iK3ArIiBDcmFjayBJRCBGcm9tIEZvbGxvd2VycyIpKQogICAgcHJpbnQoKGsrIlsiK3ArIjMiK2srIl0iK3ArIiBDcmFjayBJRCBGcm9tIFBvc3QgTGlrZXMiKSkKICAgIHByaW50KChrKyJbIitwKyI0IitrKyJdIitwKyIgQ3JhY2sgQnkgUGhvbmUgTnVtYmVyIikpCiAgICBwcmludCgoaysiWyIrcCsiNSIraysiXSIrcCsiIENyYWNrIEJ5IEVtYWlsIikpCiAgICBwcmludCgoaysiWyIrcCsiNiIraysiXSIrcCsiIEdldCBUYXJnZXQgRGF0YSIpKQogICAgcHJpbnQoKGsrIlsiK3ArIjciK2srIl0iK3ArIiBSZXN1bHQgQ3JhY2siKSkKICAgIHByaW50KChrKyJbIitwKyIwIitrKyJdIitwKyIgTG9nb3V0IikpCiAgICBjaG9vc2VfbWVudSgpCgpkZWYgY2hvb3NlX21lbnUoKToKCXI9aW5wdXQoaysiXG5bIitwKyLigKIiK2srIl0iK3ArIiBDaG9vc2UgOiAiKQoJaWYgcj09IiI6CgkJcHJpbnQoKGsrIlsiK3ArIiEiK2srIl0iK3ArIiBGaWxsIEluIFRoZSBDb3JyZWN0IikpCgkJbWVudSgpCgllbGlmIHI9PSIxIjoKCQlwdWJsaWsoKQoJZWxpZiByPT0iMiI6CgkJZm9sbG93KCkKCWVsaWYgcj09IjMiOgoJCWxpa2VycygpCgllbGlmIHI9PSI0IjoKCQlyYW5kb21fbnVtYmVycygpCgllbGlmIHI9PSI1IjoKCQlyYW5kb21fZW1haWwoKQoJZWxpZiByPT0iNiI6CgkJdGFyZ2V0KCkKCWVsaWYgcj09IjciOgoJCXJlc3MoKQoJZWxpZiByPT0iMCI6CgkJdHJ5OgoJCQlqYWxhbihrKyJcblsiK3ArIuKAoiIraysiXSIrcCsiIFRoYW5rcyBGb3IgVXNpbmcgTXkgU2NyaXB0IikKCQkJb3Muc3lzdGVtKCJybSAtcmYgbG9naW4udHh0IikKCQkJZXhpdCgpCgkJZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgoJCQlwcmludCgoaysiWyIrcCsiISIraysiXSIrcCsiIEVycm9yICVzIiVlKSkKCWVsc2U6CgkJcHJpbnQoKGsrIlsiK3ArIiEiK2srIl0iK3ArIiBXcm9uZyBJbnB1dCIpKQoJCW1lbnUoKQkKCmRlZiBwaWxpaGNyYWNrKGZpbGUpOgogIHByaW50KChrKyJcblsiK3ArIjEiK2srIl0iK3ArIiBNYmFzaWMgKCIraCsiUmVjb21tZW5kZWQiK3ArIikiKSkKICBwcmludCgoaysiWyIrcCsiMiIraysiXSIrcCsiIE1iYXNpYyArIFRUTCIpKQogIGtyYWg9aW5wdXQoaysiXG5bIitwKyLigKIiK2srIl0iK3ArIiBDaG9vc2UgOiAiKQogIGlmIGtyYWggaW5bIiJdOgogICAgcHJpbnQoKGsrIlsiK3ArIiEiK2srIl0iK3ArIiBGaWxsIEluIFRoZSBDb3JyZWN0IikpCiAgICBwaWxpaGNyYWNrKGZpbGUpCiAgZWxpZiBrcmFoIGluWyIxIiwiMDEiXToKICAgIGNyYWNrKGZpbGUpCiAgZWxpZiBrcmFoIGluWyIyIiwiMDIiXToKICAgIGNyYWNrdHRsKGZpbGUpCiAgZWxzZToKICAgIHByaW50KChrKyJbIitwKyIhIitrKyJdIitwKyIgRmlsbCBJbiBUaGUgQ29ycmVjdCIpKQogICAgcGlsaWhjcmFjayhmaWxlKQoKIyMjIERVTVAgSUQgIyMjCgpkZWYgcHVibGlrKCk6Cgl0cnk6CgkJdG9rZXQ9b3BlbigibG9naW4udHh0IiwiciIpLnJlYWQoKQoJZXhjZXB0IElPRXJyb3I6CgkJcHJpbnQoKGsrIlxuWyIrcCsiISIraysiXSIrcCsiIENvb2tpZS9Ub2tlbiBJbnZhbGlkIikpCgkJb3Muc3lzdGVtKCJybSAtcmYgbG9naW4udHh0IikKCQlsb2dzKCkKCXRyeToKCQlwcmludCgoaysiXG5bIitwKyLigKIiK2srIl0iK3ArIiBUeXBlIFwnbWVcJyBUbyBEdW1wIEZyb20gRnJpZW5kbGlzdCIpKQoJCWlkdCA9IGlucHV0KGsrIlsiK3ArIuKAoiIraysiXSIrcCsiIFVzZXIgSUQgVGFyZ2V0IDogIikKCQl0cnk6CgkJCWpvayA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vIitpZHQrIj9hY2Nlc3NfdG9rZW49Iit0b2tldCkKCQkJb3AgPSBqc29uLmxvYWRzKGpvay50ZXh0KQoJCQlwcmludCgoaysiWyIrcCsi4oCiIitrKyJdIitwKyIgTmFtZSA6ICIrb3BbIm5hbWUiXSkpCgkJZXhjZXB0IEtleUVycm9yOgoJCQlwcmludCgoaysiWyIrcCsiISIraysiXSIrcCsiIElEIE5vdCBGb3VuZCIpKQoJCQlwcmludCgoaysiXG5bICIrcCsiQmFjayIraysiIF0iK3ApKQoJCQlwdWJsaWsoKQoJCXI9cmVxdWVzdHMuZ2V0KCJodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS8iK2lkdCsiL2ZyaWVuZHM/bGltaXQ9MTAwMDAmYWNjZXNzX3Rva2VuPSIrdG9rZXQpCgkJaWQgPSBbXQoJCXo9anNvbi5sb2FkcyhyLnRleHQpCgkJcXEgPSAob3BbImZpcnN0X25hbWUiXSsiLmpzb24iKS5yZXBsYWNlKCIgIiwiXyIpCgkJeXMgPSBvcGVuKHFxICwgInciKSMucmVwbGFjZSgiICIsIl8iKQoJCWZvciBhIGluIHpbImRhdGEiXToKCQkJaWQuYXBwZW5kKGFbImlkIl0rIjw9PiIrYVsibmFtZSJdKQoJCQl5cy53cml0ZShhWyJpZCJdKyI8PT4iK2FbIm5hbWUiXSsiXG4iKQoJCXlzLmNsb3NlKCkKCQlwcmludCgoaysiWyIrcCsi4oCiIitrKyJdIitwKyIgVG90YWwgSUQgOiAlcyIlKGxlbihpZCkpKSkKCQlyZXR1cm4gcGlsaWhjcmFjayhxcSkKCWV4Y2VwdCBFeGNlcHRpb24gYXMgZToKCQlleGl0KGsrIlsiK3ArIiEiK2srIl0iK3ArIiBFcnJvciA6ICVzIiVlKQoKZGVmIGZvbGxvdygpOgoJdHJ5OgoJCXRva2V0PW9wZW4oImxvZ2luLnR4dCIsInIiKS5yZWFkKCkKCWV4Y2VwdCBJT0Vycm9yOgoJCXByaW50KChrKyJcblsiK3ArIiEiK2srIl0iK3ArIiBDb29raWUvVG9rZW4gSW52YWxpZCIpKQoJCW9zLnN5c3RlbSgicm0gLXJmIGxvZ2luLnR4dCIpCgkJbG9ncygpCgl0cnk6CgkJaWR0ID0gaW5wdXQoaysiXG5bIitwKyLigKIiK2srIl0iK3ArIiBGb2xsb3dlcnMgSUQgVGFyZ2V0IDogIikKCQl0cnk6CgkJCWpvayA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vIitpZHQrIj9hY2Nlc3NfdG9rZW49Iit0b2tldCkKCQkJb3AgPSBqc29uLmxvYWRzKGpvay50ZXh0KQoJCQlwcmludCgoaysiWyIrcCsi4oCiIitrKyJdIitwKyIgTmFtZSA6ICIrb3BbIm5hbWUiXSkpCgkJZXhjZXB0IEtleUVycm9yOgoJCQlwcmludCgoaysiWyIrcCsiISIraysiXSIrcCsiIElEIE5vdCBGb3VuZCIpKQoJCQlwcmludCgoaysiXG5bICIrcCsiQmFjayIraysiIF0iK3ApKQoJCQlwdWJsaWsoKQoJCXI9cmVxdWVzdHMuZ2V0KCJodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS8iK2lkdCsiL3N1YnNjcmliZXJzP2xpbWl0PTIwMDAwJmFjY2Vzc190b2tlbj0iK3Rva2V0KQoJCWlkID0gW10KCQl6PWpzb24ubG9hZHMoci50ZXh0KQoJCXFxID0gKG9wWyJmaXJzdF9uYW1lIl0rIi5qc29uIikucmVwbGFjZSgiICIsIl8iKQoJCXlzID0gb3BlbihxcSAsICJ3IikjLnJlcGxhY2UoIiAiLCJfIikKCQlmb3IgYSBpbiB6WyJkYXRhIl06CgkJCWlkLmFwcGVuZChhWyJpZCJdKyI8PT4iK2FbIm5hbWUiXSkKCQkJeXMud3JpdGUoYVsiaWQiXSsiPD0+IithWyJuYW1lIl0rIlxuIikKCQl5cy5jbG9zZSgpCgkJcHJpbnQoKGsrIlsiK3ArIuKAoiIraysiXSIrcCsiIFRvdGFsIElEIDogJXMiJShsZW4oaWQpKSkpCgkJcmV0dXJuIHBpbGloY3JhY2socXEpCglleGNlcHQgRXhjZXB0aW9uIGFzIGU6CgkJZXhpdChrKyJbIitwKyIhIitrKyJdIitwKyIgRXJyb3IgOiAlcyIlZSkKCmRlZiBsaWtlcnMoKToKCXRyeToKCQl0b2tldD1vcGVuKCJsb2dpbi50eHQiLCJyIikucmVhZCgpCglleGNlcHQgSU9FcnJvcjoKCQlwcmludCgoaysiXG5bIitwKyIhIitrKyJdIitwKyIgQ29va2llL1Rva2VuIEludmFsaWQiKSkKCQlvcy5zeXN0ZW0oInJtIC1yZiBsb2dpbi50eHQiKQoJCWxvZ3MoKQoJdHJ5OgoJCWlkdCA9IGlucHV0KGsrIlxuWyIrcCsi4oCiIitrKyJdIitwKyIgSUQgUG9zdCBUYXJnZXQgOiAiKQoJCXRyeToKCQkJam9rID0gcmVxdWVzdHMuZ2V0KCJodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS8iK2lkdCsiP2FjY2Vzc190b2tlbj0iK3Rva2V0KQoJCQlvcCA9IGpzb24ubG9hZHMoam9rLnRleHQpCgkJCXByaW50KChrKyJbIitwKyLigKIiK2srIl0iK3ArIiBOYW1lIDogIitvcFsibmFtZSJdKSkKCQlleGNlcHQgS2V5RXJyb3I6CgkJCXByaW50KChrKyJbIitwKyIhIitrKyJdIitwKyIgSUQgTm90IEZvdW5kIikpCgkJCXByaW50KChrKyJcblsgIitwKyJCYWNrIitrKyIgXSIrcCkpCgkJCXB1YmxpaygpCgkJcj1yZXF1ZXN0cy5nZXQoImh0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tLyIraWR0KyIvbGlrZXM/bGltaXQ9MTAwMDAwJmFjY2Vzc190b2tlbj0iK3Rva2V0KQoJCWlkID0gW10KCQl6PWpzb24ubG9hZHMoci50ZXh0KQoJCXFxID0gKG9wWyJmaXJzdF9uYW1lIl0rIi5qc29uIikucmVwbGFjZSgiICIsIl8iKQoJCXlzID0gb3BlbihxcSAsICJ3IikjLnJlcGxhY2UoIiAiLCJfIikKCQlmb3IgYSBpbiB6WyJkYXRhIl06CgkJCWlkLmFwcGVuZChhWyJpZCJdKyI8PT4iK2FbIm5hbWUiXSkKCQkJeXMud3JpdGUoYVsiaWQiXSsiPD0+IithWyJuYW1lIl0rIlxuIikKCQl5cy5jbG9zZSgpCgkJcHJpbnQoKGsrIlsiK3ArIuKAoiIraysiXSIrcCsiIFRvdGFsIElEIDogJXMiJShsZW4oaWQpKSkpCgkJcmV0dXJuIHBpbGloY3JhY2socXEpCglleGNlcHQgRXhjZXB0aW9uIGFzIGU6CgkJZXhpdChrKyJbIitwKyIhIitrKyJdIitwKyIgRXJyb3IgOiAlcyIlZSkKCiMjIyBDUkFDSyBFTUFJTCAmIFBIT05FICMjIwoKZGVmIHJhbmRvbV9udW1iZXJzKCk6CiAgZGF0YSA9IFtdCiAgcHJpbnQoKGsrIlxuWyIrcCsi4oCiIitrKyJdIitwKyIgTnVtYmVyIE11c3QgQmUgNSBEaWdpdCIpKQogIHByaW50KChrKyJbIitwKyLigKIiK2srIl0iK3ArIiBFeGFtcGxlIDogOTIwMzciKSkKICBrb2RlPXN0cihpbnB1dChrKyJbIitwKyLigKIiK2srIl0iK3ArIiBJbnB1dCBOdW1iZXIgOiAiKSkKICBleGl0KChrKyJcblsiK3ArIiEiK2srIl0iK3ArIiBOdW1iZXIgTXVzdCBCZSA1IERpZ2l0IikpIGlmIGxlbihrb2RlKSA8IDUgZWxzZSAnJwogIGV4aXQoKGsrIlxuWyIrcCsiISIraysiXSIrcCsiIE51bWJlciBNdXN0IEJlIDUgRGlnaXQiKSkgaWYgbGVuKGtvZGUpID4gNSBlbHNlICcnCiAgam1sPWludChpbnB1dChrKyJbIitwKyLigKIiK2srIl0iK3ArIiBBbW91bnQgOiAiKSkKICBbZGF0YS5hcHBlbmQoeyd1c2VyJzogc3RyKGUpLCAncHcnOltzdHIoZVs1Ol0pLCBzdHIoZVs2Ol0pXX0pIGZvciBlIGluIFtzdHIoa29kZSkrJycuam9pbihbJyVzJyUocmFuZGludCgwLDkpKSBmb3IgaSBpbiByYW5nZSgwLDcpXSkgZm9yIGUgaW4gcmFuZ2Uoam1sKV1dCiAgcHJpbnQoaysiXG5bIitwKyLigKIiK2srIl0iK3ArIiBDcmFjayBTdGFydGVkLCBQbGVhc2UgV2FpdC4uLlxuIikKICB3aXRoIGNvbmN1cnJlbnQuZnV0dXJlcy5UaHJlYWRQb29sRXhlY3V0b3IobWF4X3dvcmtlcnM9MTUpIGFzIHRoOgogICAge3RoLnN1Ym1pdChicnV0ZSwgdXNlclsndXNlciddLCB1c2VyWydwdyddKTogdXNlciBmb3IgdXNlciBpbiBkYXRhfQogIGlucHV0KGsrIlxuWyAiK3ArIkJhY2siK2srIiBdIitwKQogIG1lbnUoKQoKZGVmIHJhbmRvbV9lbWFpbCgpOgogIGRhdGEgPSBbXQogIG5hbWE9aW5wdXQoaysiXG5bIitwKyLigKIiK2srIl0iK3ArIiBUYXJnZXQgTmFtZSA6ICIpCiAgZG9tYWluPWlucHV0KGsrIlsiK3ArIuKAoiIraysiXSIrcCsiIENob29zZSBEb21haW4gW0ddbWFpbCwgW1ldYWhvbywgW0hdb3RtYWlsIDogIikubG93ZXIoKS5zdHJpcCgpCiAgbGlzdD17CiAgICAnZyc6J0BnbWFpbC5jb20nLAogICAgJ3knOidAeWFob28uY29tJywKICAgICdoJzonQGhvdG1haWwuY29tJwogIH0KICBleGl0KChrKyJbIitwKyLigKIiK2srIl0iK3ArIiBGaWxsIEluIFRoZSBDb3JyZWN0IikpIGlmIG5vdCBkb21haW4gaW4gWydnJywneScsJ2gnXSBlbHNlICcnCiAgam1sPWludChpbnB1dChrKyJbIitwKyLigKIiK2srIl0iK3ArIiBBbW91bnQgOiAiKSkKICBzZXRwdz1pbnB1dChrKyJbIitwKyLigKIiK2srIl0iK3ArIiBTZXQgUGFzc3dvcmQgOiAiKS5zcGxpdCgnLCcpCiAgcHJpbnQoaysiXG5bIitwKyLigKIiK2srIl0iK3ArIiBDcmFjayBTdGFydGVkLCBQbGVhc2UgV2FpdC4uLlxuIikKICBbZGF0YS5hcHBlbmQoeyd1c2VyJzogbmFtYStzdHIoZSkrbGlzdFtkb21haW5dLCAncHcnOlsoaSkgZm9yIGkgaW4gc2V0cHddfSkgZm9yIGUgaW4gcmFuZ2UoMSxqbWwrMSldCiAgd2l0aCBjb25jdXJyZW50LmZ1dHVyZXMuVGhyZWFkUG9vbEV4ZWN1dG9yKG1heF93b3JrZXJzPTE1KSBhcyB0aDoKICAgIHt0aC5zdWJtaXQoYnJ1dGUsIHVzZXJbJ3VzZXInXSwgdXNlclsncHcnXSk6IHVzZXIgZm9yIHVzZXIgaW4gZGF0YX0KICBpbnB1dChrKyJcblsgIitwKyJCYWNrIitrKyIgXSIrcCkKICBtZW51KCkKCmRlZiBicnV0ZSh1c2VyLCBwYXNzcyk6CiAgdHJ5OgogICAgZm9yIHB3IGluIHBhc3NzOgogICAgICBwYXJhbXM9ewogICAgICAgICdhY2Nlc3NfdG9rZW4nOiAnMzUwNjg1NTMxNzI4JTdDNjJmOGNlOWY3NGIxMmY4NGMxMjNjYzIzNDM3YTRhMzInLAogICAgICAgICdmb3JtYXQnOiAnSlNPTicsCiAgICAgICAgJ3Nka192ZXJzaW9uJzogJzInLAogICAgICAgICdlbWFpbCc6IHVzZXIsCiAgICAgICAgJ2xvY2FsZSc6ICdlbl9VUycsCiAgICAgICAgJ3Bhc3N3b3JkJzogcHcsCiAgICAgICAgJ3Nkayc6ICdpb3MnLAogICAgICAgICdnZW5lcmF0ZV9zZXNzaW9uX2Nvb2tpZXMnOiAnMScsCiAgICAgICAgJ3NpZyc6ICczZjU1NWY5OWZiNjFmY2Q3YWEwYzQ0ZjU4ZjUyMmVmNicsCiAgICAgIH0KICAgICAgYXBpPSdodHRwczovL2ItYXBpLmZhY2Vib29rLmNvbS9tZXRob2QvYXV0aC5sb2dpbicKICAgICAgcmVzcG9uc2U9cmVxdWVzdHMuZ2V0KGFwaSwgcGFyYW1zPXBhcmFtcykKICAgICAgaWYgcmUuc2VhcmNoKCcoRUFBQSlcdysnLCBzdHIocmVzcG9uc2UudGV4dCkpOgogICAgICAgIHByaW50KCdceDFiWzA7MzJtW1x4MWJbMDszN21LYWNoaS1PS1x4MWJbMDszMm1dICVzIOKAoiAlcyAnJShzdHIodXNlciksIHN0cihwdykpKQogICAgICAgIGJyZWFrCiAgICAgIGVsaWYgJ3d3dy5mYWNlYm9vay5jb20nIGluIHJlc3BvbnNlLmpzb24oKVsnZXJyb3JfbXNnJ106CiAgICAgICAgcHJpbnQoJ1x4MWJbMDszM21bXHgxYlswOzM3bUthY2hpLUNQXHgxYlswOzMzbV0gJXMg4oCiICVzICclKHN0cih1c2VyKSwgc3RyKHB3KSkpCiAgICAgICAgYnJlYWsKICBleGNlcHQ6IHBhc3MKCiMjIyBJTkZPIEFDQ09VTlQgIyMjCgpkZWYgdGFyZ2V0KCk6Cgl0cnk6CgkJdG9rZXQ9b3BlbigibG9naW4udHh0IiwiciIpLnJlYWQoKQoJZXhjZXB0IElPRXJyb3I6CgkJcHJpbnQoKGsrIlxuWyIrcCsiISIraysiXSIrcCsiIFRva2VuIEludmFsaWQiKSkKCQlvcy5zeXN0ZW0oInJtIC1yZiBsb2dpbi50eHQiKQoJCWxvZ2luKCkKCXRyeToKCQlpZHQgPSBpbnB1dChrKyJcblsiK3ArIuKAoiIraysiXSIrcCsiIElEIFRhcmdldCAgICAgICAgOiAiKQoJCXRyeToKCQkJam9rID0gcmVxdWVzdHMuZ2V0KCJodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS8iK2lkdCsiP2FjY2Vzc190b2tlbj0iK3Rva2V0KQoJCQlvcCA9IGpzb24ubG9hZHMoam9rLnRleHQpCgkJCXByaW50KChrKyJbIitwKyLigKIiK2srIl0iK3ArIiBOYW1lIEFjY291bnQgICAgIDogIitvcFsibmFtZSJdKSkKCQkJcHJpbnQoKGsrIlsiK3ArIuKAoiIraysiXSIrcCsiIFVzZXJuYW1lICAgICAgICAgOiAiK29wWyJ1c2VybmFtZSJdKSkKCQkJdHJ5OgoJCQkJam9rID0gcmVxdWVzdHMuZ2V0KCJodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS8iK2lkdCsiP2FjY2Vzc190b2tlbj0iK3Rva2V0KQoJCQkJb3AgPSBqc29uLmxvYWRzKGpvay50ZXh0KQoJCQkJcHJpbnQoKGsrIlsiK3ArIuKAoiIraysiXSIrcCsiIEVtYWlsICAgICAgICAgICAgOiAiK29wWyJlbWFpbCJdKSkKCQkJZXhjZXB0IEtleUVycm9yOgoJCQkJcHJpbnQoKGsrIlsiK3ArIuKAoiIraysiXSIrcCsiIEVtYWlsICAgICAgICAgICAgOiAtIikpCgkJCXRyeToKCQkJCWpvayA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vIitpZHQrIj9hY2Nlc3NfdG9rZW49Iit0b2tldCkKCQkJCW9wID0ganNvbi5sb2Fkcyhqb2sudGV4dCkKCQkJCXByaW50KChrKyJbIitwKyLigKIiK2srIl0iK3ArIiBEYXRlIE9mIEJpcnRoICAgIDogIitvcFsiYmlydGhkYXkiXSkpCgkJCWV4Y2VwdCBLZXlFcnJvcjoKCQkJCXByaW50KChrKyJbIitwKyLigKIiK2srIl0iK3ArIiBEYXRlIE9mIEJpcnRoICAgIDogLSIpKQoJCQl0cnk6CgkJCQlqb2sgPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tLyIraWR0KyI/YWNjZXNzX3Rva2VuPSIrdG9rZXQpCgkJCQlvcCA9IGpzb24ubG9hZHMoam9rLnRleHQpCgkJCQlwcmludCgoaysiWyIrcCsi4oCiIitrKyJdIitwKyIgR2VuZGVyICAgICAgICAgICA6ICIrb3BbImdlbmRlciJdKSkKCQkJZXhjZXB0IEtleUVycm9yOgoJCQkJcHJpbnQoKGsrIlsiK3ArIuKAoiIraysiXSIrcCsiIEdlbmRlciAgICAgICAgICAgOiAtIikpCgkJCXRyeToKCQkJCXIgPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tLyIraWR0KyIvZnJpZW5kcz9hY2Nlc3NfdG9rZW49Iit0b2tldCkKCQkJCWlkID0gW10KCQkJCXogPSBqc29uLmxvYWRzKHIudGV4dCkKCQkJCXFxID0gKG9wWyJmaXJzdF9uYW1lIl0rIi5qc29uIikucmVwbGFjZSgiICIsIl8iKQoJCQkJeXMgPSBvcGVuKHFxICwgInciKQoJCQkJZm9yIGkgaW4gelsiZGF0YSJdOgoJCQkJCWlkLmFwcGVuZChpWyJpZCJdKQoJCQkJCXlzLndyaXRlKGlbImlkIl0pCgkJCQl5cy5jbG9zZSgpCgkJCQlwcmludCgoaysiWyIrcCsi4oCiIitrKyJdIitwKyIgVG90YWwgRnJpZW5kICAgICA6ICVzIiUobGVuKGlkKSkpKQoJCQlleGNlcHQgS2V5RXJyb3I6CgkJCQlwcmludCgoaysiWyIrcCsi4oCiIitrKyJdIitwKyIgVG90YWwgRnJpZW5kICAgICA6IC0iKSkKCQkJdHJ5OgoJCQkJYT1yZXF1ZXN0cy5nZXQoImh0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tLyIraWR0KyIvc3Vic2NyaWJlcnM/bGltaXQ9MjAwMDAmYWNjZXNzX3Rva2VuPSIrdG9rZXQpCgkJCQlpZCA9IFtdCgkJCQliID0ganNvbi5sb2FkcyhhLnRleHQpCgkJCQliYiA9IChvcFsiZmlyc3RfbmFtZSJdKyIuanNvbiIpLnJlcGxhY2UoIiAiLCJfIikKCQkJCWp3ID0gb3BlbihiYiAsICJ3IikKCQkJCWZvciBjIGluIGJbImRhdGEiXToKCQkJCQlpZC5hcHBlbmQoY1siaWQiXSkKCQkJCQlqdy53cml0ZShjWyJpZCJdKQoJCQkJancuY2xvc2UoKQoJCQkJcHJpbnQoKGsrIlsiK3ArIuKAoiIraysiXSIrcCsiIFRvdGFsIEZvbGxvd2VyICAgOiAlcyIlKGxlbihpZCkpKSkKCQkJZXhjZXB0IEtleUVycm9yOgoJCQkJcHJpbnQoKGsrIlsiK3ArIuKAoiIraysiXSIrcCsiIFRvdGFsIEZvbGxvd2VyICAgOiAtIikpCgkJCXRyeToKCQkJCWpvayA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vIitpZHQrIj9hY2Nlc3NfdG9rZW49Iit0b2tldCkKCQkJCW9wID0ganNvbi5sb2Fkcyhqb2sudGV4dCkKCQkJCXByaW50KChrKyJbIitwKyLigKIiK2srIl0iK3ArIiBXZWJzaXRlICAgICAgICAgIDogIitvcFsid2Vic2l0ZSJdKSkKCQkJZXhjZXB0IEtleUVycm9yOgoJCQkJcHJpbnQoKGsrIlsiK3ArIuKAoiIraysiXSIrcCsiIFdlYnNpdGUgICAgICAgICAgOiAtIikpCgkJCWV4Y2VwdCBJT0Vycm9yOgoJCQkJcHJpbnQoKGsrIlsiK3ArIuKAoiIraysiXSIrcCsiIFdlYnNpdGUgICAgICAgICAgOiAtIikpCgkJCXRyeToKCQkJCWpvayA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vIitpZHQrIj9hY2Nlc3NfdG9rZW49Iit0b2tldCkKCQkJCW9wID0ganNvbi5sb2Fkcyhqb2sudGV4dCkKCQkJCXByaW50KChrKyJbIitwKyLigKIiK2srIl0iK3ArIiBVcGRhdGUgVGltZSAgICAgIDogIitvcFsidXBkYXRlZF90aW1lIl0pKQoJCQlleGNlcHQgS2V5RXJyb3I6CgkJCQlwcmludCgoaysiWyIrcCsi4oCiIitrKyJdIitwKyIgVXBkYXRlIFRpbWUgICAgICA6IC0iKSkKCQkJZXhjZXB0IElPRXJyb3I6CgkJCQlwcmludCgoaysiWyIrcCsi4oCiIitrKyJdIitwKyIgVXBkYXRlIFRpbWUgICAgICA6IC0iKSkKCQkJaW5wdXQoaysiXG5bICIrcCsiQmFjayIraysiIF0iK3ApCgkJCW1lbnUoKQoJCWV4Y2VwdCBLZXlFcnJvcjoKCQkJaW5wdXQoaysiXG5bICIrcCsiQmFjayIraysiIF0iK3ApCgkJCW1lbnUoKQoJZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgoJCWV4aXQoaysiWyIrcCsi4oCiIitrKyJdIitwKyIgRXJyb3IgOiAlcyIlZSkKCiMjIyBQQVNTV09SRCAjIyMKCmRlZiBnZW5lcmF0ZSh0ZXh0KToKCXJlc3VsdHM9W10KCWdsb2JhbCBpcHMKCWZvciBpIGluIHRleHQuc3BsaXQoIiAiKToKCQlpZiBsZW4oaSk8MzoKCQkJY29udGludWUKCQllbHNlOgoJCQlpPWkubG93ZXIoKQoJCQlpZiBsZW4oaSk9PTMgb3IgbGVuKGkpPT00IG9yIGxlbihpKT09NToKCQkJCXJlc3VsdHMuYXBwZW5kKGkrIjEyMyIpCgkJCQlyZXN1bHRzLmFwcGVuZChpKyIxMjM0NSIpCgkJCWVsc2U6CgkJCQlyZXN1bHRzLmFwcGVuZChpKyIxMjMiKQoJCQkJcmVzdWx0cy5hcHBlbmQoaSsiMTIzNDUiKQoJCQkJcmVzdWx0cy5hcHBlbmQoaSkKCQkJCWlmICJpbmRvbmVzaWEiIGluIGlwczoKCQkJCQlyZXN1bHRzLmFwcGVuZCgic2F5YW5nIikKCQkJCQlyZXN1bHRzLmFwcGVuZCgiYmlzbWlsbGFoIikKCQkJCQlyZXN1bHRzLmFwcGVuZCgiYW5qaW5nIikKCQkJCQlyZXN1bHRzLmFwcGVuZCgiMTIzNDU2IikKCXJldHVybiByZXN1bHRzCgojIyMgQlJVVEUgQ1JBQ0sgIyMjCgpkZWYgbWJhc2ljKGVtLHBhcyxob3N0cyk6CglyPXJlcXVlc3RzLlNlc3Npb24oKQoJci5oZWFkZXJzLnVwZGF0ZSh7Ikhvc3QiOiJtYmFzaWMuZmFjZWJvb2suY29tIiwiY2FjaGUtY29udHJvbCI6Im1heC1hZ2U9MCIsInVwZ3JhZGUtaW5zZWN1cmUtcmVxdWVzdHMiOiIxIiwidXNlci1hZ2VudCI6Ik1vemlsbGEvNS4wIChMaW51eDsgQW5kcm9pZCAxMDsgTWkgOVQgUHJvIEJ1aWxkL1FLUTEuMTkwODI1LjAwMjsgd3YpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIFZlcnNpb24vNC4wIENocm9tZS84OC4wLjQzMjQuMTgxIE1vYmlsZSBTYWZhcmkvNTM3LjM2W0ZCQU4vRU1BO0ZCTEMvaXRfSVQ7RkJBVi8yMzkuMC4wLjEwLjEwOTtdIiwiYWNjZXB0IjoidGV4dC9odG1sLGFwcGxpY2F0aW9uL3hodG1sK3htbCxhcHBsaWNhdGlvbi94bWw7cT0wLjksaW1hZ2Uvd2VicCxpbWFnZS9hcG5nLCovKjtxPTAuOCIsImFjY2VwdC1lbmNvZGluZyI6Imd6aXAsIGRlZmxhdGUiLCJhY2NlcHQtbGFuZ3VhZ2UiOiJpZC1JRCxpZDtxPTAuOSxlbi1VUztxPTAuOCxlbjtxPTAuNyJ9KQoJcD1yLmdldCgiaHR0cHM6Ly9tYmFzaWMuZmFjZWJvb2suY29tLyIpCgliPWJzNC5CZWF1dGlmdWxTb3VwKHAudGV4dCwiaHRtbC5wYXJzZXIiKQoJbWV0YT0iIi5qb2luKGJzNC5yZS5maW5kYWxsKCdkdHNnIjpceyJ0b2tlbiI6IiguKj8pIicscC50ZXh0KSkKCWRhdGE9e30KCWZvciBpIGluIGIoImlucHV0Iik6CgkJaWYgaS5nZXQoInZhbHVlIikgaXMgTm9uZToKCQkJaWYgaS5nZXQoIm5hbWUiKT09ImVtYWlsIjoKCQkJCWRhdGEudXBkYXRlKHsiZW1haWwiOmVtfSkKCQkJZWxpZiBpLmdldCgibmFtZSIpPT0icGFzcyI6CgkJCQlkYXRhLnVwZGF0ZSh7InBhc3MiOnBhc30pCgkJCWVsc2U6CgkJCQlkYXRhLnVwZGF0ZSh7aS5nZXQoIm5hbWUiKToiIn0pCgkJZWxzZToKCQkJZGF0YS51cGRhdGUoe2kuZ2V0KCJuYW1lIik6aS5nZXQoInZhbHVlIil9KQoJZGF0YS51cGRhdGUoCgkJeyJmYl9kdHNnIjptZXRhLCJtX3Nlc3MiOiIiLCJfX3VzZXIiOiIwIiwKCQkiX19yZXEiOiJkIiwiX19jc3IiOiIiLCJfX2EiOiIiLCJfX2R5biI6IiIsImVuY3Bhc3MiOiIiCgkJfQoJKQoJci5oZWFkZXJzLnVwZGF0ZSh7InJlZmVyZXIiOiJodHRwczovL21iYXNpYy5mYWNlYm9vay5jb20vbG9naW4vP25leHQmcmVmPWRibCZmbCZyZWZpZD04In0pCglwbz1yLnBvc3QoImh0dHBzOi8vbWJhc2ljLmZhY2Vib29rLmNvbS9sb2dpbi9kZXZpY2UtYmFzZWQvbG9naW4vYXN5bmMvP3JlZnNyYz1odHRwcyUzQSUyRiUyRm0uZmFjZWJvb2suY29tJTJGbG9naW4lMkYlM0ZyZWYlM0RkYmwmbHd2PTEwMCIsZGF0YT1kYXRhKS50ZXh0CglpZiAiY191c2VyIiBpbiBsaXN0KHIuY29va2llcy5nZXRfZGljdCgpLmtleXMoKSk6CgkJcmV0dXJuIHsic3RhdHVzIjoic3VjY2VzcyIsImVtYWlsIjplbSwicGFzcyI6cGFzLCJjb29raWVzIjpyLmNvb2tpZXMuZ2V0X2RpY3QoKX0KCWVsaWYgImNoZWNrcG9pbnQiIGluIGxpc3Qoci5jb29raWVzLmdldF9kaWN0KCkua2V5cygpKToKCQlyZXR1cm4geyJzdGF0dXMiOiJjcCIsImVtYWlsIjplbSwicGFzcyI6cGFzLCJjb29raWVzIjpyLmNvb2tpZXMuZ2V0X2RpY3QoKX0KCWVsc2U6cmV0dXJuIHsic3RhdHVzIjoiZXJyb3IiLCJlbWFpbCI6ZW0sInBhc3MiOnBhc30KCmNsYXNzIGNyYWNrOgoJb3Muc3lzdGVtKCJjbGVhciIpCgliYW5uZXIoKQoJZGVmIF9faW5pdF9fKHNlbGYsaXNpZmlsZSk6CgkJc2VsZi5hZGE9W10KCQlzZWxmLmNwPVtdCgkJc2VsZi5rbz0wCgkJcHJpbnQoKGsrIlxuWyIrcCsi4oCiIitrKyJdIitwKyIgQ3JhY2sgV2l0aCBQYXNzIERlZmF1bHQvTWFudWFsIFtkL21dIikpCgkJd2hpbGUgVHJ1ZToKCQkJZj1pbnB1dChrKyJbIitwKyLigKIiK2srIl0iK3ArIiBDaG9vc2UgOiAiKQoJCQlpZiBmPT0iIjpjb250aW51ZQoJCQllbGlmIGY9PSJtIjoKCQkJCXRyeToKCQkJCQl3aGlsZSBUcnVlOgoJCQkJCQl0cnk6CgkJCQkJCQlzZWxmLmFwaz1pc2lmaWxlCgkJCQkJCQlzZWxmLmZzPW9wZW4oc2VsZi5hcGspLnJlYWQoKS5zcGxpdGxpbmVzKCkKCQkJCQkJCWJyZWFrCgkJCQkJCWV4Y2VwdCBFeGNlcHRpb24gYXMgZToKCQkJCQkJCXByaW50KCgiICAgJXMiJWUpKQoJCQkJCQkJY29udGludWUKCQkJCQlzZWxmLmZsPVtdCgkJCQkJZm9yIGkgaW4gc2VsZi5mczoKCQkJCQkJdHJ5OgoJCQkJCQkJc2VsZi5mbC5hcHBlbmQoeyJpZCI6aS5zcGxpdCgiPD0+IilbMF19KQoJCQkJCQlleGNlcHQ6Y29udGludWUKCQkJCWV4Y2VwdCBFeGNlcHRpb24gYXMgZToKCQkJCQlwcmludCgoIiAgICVzIiVlKSkKCQkJCQljb250aW51ZQoJCQkJcHJpbnQoKGsrIlsiK3ArIuKAoiIraysiXSIrcCsiIEV4YW1wbGUgOiBzYXlhbmcsYmlzbWlsbGFoLDEyMzQ1NiIpKQoJCQkJc2VsZi5wd2xpc3QoKQoJCQkJYnJlYWsKCQkJZWxpZiBmPT0iZCI6CgkJCQl0cnk6CgkJCQkJd2hpbGUgVHJ1ZToKCQkJCQkJdHJ5OgoJCQkJCQkJc2VsZi5hcGs9aXNpZmlsZQoJCQkJCQkJc2VsZi5mcz1vcGVuKHNlbGYuYXBrKS5yZWFkKCkuc3BsaXRsaW5lcygpCgkJCQkJCQlicmVhawoJCQkJCQlleGNlcHQgRXhjZXB0aW9uIGFzIGU6CgkJCQkJCQlwcmludCgoIiAgICVzIiVlKSkKCQkJCQkJCWNvbnRpbnVlCgkJCQkJc2VsZi5mbD1bXQoJCQkJCWZvciBpIGluIHNlbGYuZnM6CgkJCQkJCXRyeToKCQkJCQkJCXNlbGYuZmwuYXBwZW5kKHsiaWQiOmkuc3BsaXQoIjw9PiIpWzBdLCJwdyI6Z2VuZXJhdGUoaS5zcGxpdCgiPD0+IilbMV0pfSkKCQkJCQkJZXhjZXB0OmNvbnRpbnVlCgkJCQlleGNlcHQgRXhjZXB0aW9uIGFzIGU6CgkJCQkJcHJpbnQoKCIgICAlcyIlZSkpCgkJCQlwcmludCgoaysiXG5bIitwKyLigKIiK2srIl0iK3ArIiBDcmFjayBTdGFydGVkLi4uIitrKyJcblsiK3ArIuKAoiIraysiXSIrcCsiIEFjY291bnQgW0thY2hpLU9LXSBTYXZlZCB0byA6IEthY2hpLU9LLnR4dCIraysiXG5bIitwKyLigKIiK2srIl0iK3ArIiBBY2NvdW50IFtLYWNoaS1DUF0gU2F2ZWQgdG8gOiBLYWNoaS1DUC50eHRcbiIpKQoJCQkJVGhyZWFkUG9vbCgzNSkubWFwKHNlbGYubWFpbixzZWxmLmZsKQoJCQkJb3MucmVtb3ZlKHNlbGYuYXBrKQoJCQkJZXhpdCgpCgkJCQlicmVhawoJZGVmIHB3bGlzdChzZWxmKToKCQlzZWxmLnB3PWlucHV0KGsrIlsiK3ArIuKAoiIraysiXSIrcCsiIFBhc3N3b3JkIExpc3QgOiAiKS5zcGxpdCgiLCIpCgkJaWYgbGVuKHNlbGYucHcpID09MDoKCQkJc2VsZi5wd2xpc3QoKQoJCWVsc2U6CgkJCWZvciBpIGluIHNlbGYuZmw6CgkJCQlpLnVwZGF0ZSh7InB3IjpzZWxmLnB3fSkKCQkJcHJpbnQoKGsrIlxuWyIrcCsi4oCiIitrKyJdIitwKyIgQ3JhY2sgU3RhcnRlZC4uLiIraysiXG5bIitwKyLigKIiK2srIl0iK3ArIiBBY2NvdW50IFtLYWNoaS1PS10gU2F2ZWQgdG8gOiBLYWNoaS1PSy50eHQiK2srIlxuWyIrcCsi4oCiIitrKyJdIitwKyIgQWNjb3VudCBbS2FjaGktQ1BdIFNhdmVkIHRvIDogS2FjaGktQ1AudHh0XG4iKSkKCQkJVGhyZWFkUG9vbCgzMCkubWFwKHNlbGYubWFpbixzZWxmLmZsKQoJCQlvcy5yZW1vdmUoc2VsZi5hcGspCgkJCWV4aXQoKQoJZGVmIG1haW4oc2VsZixmbCk6CgkJdHJ5OgoJCQlmb3IgaSBpbiBmbC5nZXQoInB3Iik6CgkJCQlsb2c9bWJhc2ljKGZsLmdldCgiaWQiKSwKCQkJCQlpLCJodHRwczovL21iYXNpYy5mYWNlYm9vay5jb20iKQoJCQkJaWYgbG9nLmdldCgic3RhdHVzIik9PSJjcCI6CgkJCQkJcHJpbnQoKCJcclx4MWJbMDszM21bXHgxYlswOzM3bUthY2hpLUNQXHgxYlswOzMzbV0gJXMg4oCiICVzICAgICAgICAgICAgICAgIiUoZmwuZ2V0KCJpZCIpLGkpKSkKCQkJCQlzZWxmLmNwLmFwcGVuZCgiJXMg4oCiICVzIiUoZmwuZ2V0KCJpZCIpLGkpKQoJCQkJCW9wZW4oIkthY2hpLUNQLnR4dCIsImErIikud3JpdGUoCgkJCQkJCSIlcyDigKIgJXNcbiIlKGZsLmdldCgiaWQiKSxpKSkKCQkJCQlicmVhawoJCQkJZWxpZiBsb2cuZ2V0KCJzdGF0dXMiKT09InN1Y2Nlc3MiOgoJCQkJCXByaW50KCgiXHJceDFiWzA7MzJtW1x4MWJbMDszN21LYWNoaS1PS1x4MWJbMDszMm1dICVzIOKAoiAlcyAgICAgICAgICAgICAgICIlKGZsLmdldCgiaWQiKSxpKSkpCgkJCQkJc2VsZi5hZGEuYXBwZW5kKCIlcyDigKIgJXMiJShmbC5nZXQoImlkIiksaSkpCgkJCQkJb3BlbigiS2FjaGktT0sudHh0IiwiYSsiKS53cml0ZSgKCQkJCQkJIiVzIOKAoiAlc1xuIiUoZmwuZ2V0KCJpZCIpLGkpKQoJCQkJCWJyZWFrCgkJCQllbHNlOmNvbnRpbnVlCgkJCQkJCgkJCXNlbGYua28rPTEKCQkJcHJpbnQoIlxyXHgxYlswOzMzbVtceDFiWzA7MzdtQ3JhY2tceDFiWzA7MzNtXVx4MWJbMDszN20gJXMvJXMgXHgxYlswOzMybVtceDFiWzA7MzdtS2FjaGktT0sgOiAlc1x4MWJbMDszMm1dIFx4MWJbMDszM21bXHgxYlswOzM3bUthY2hpLUNQIDogJXNceDFiWzA7MzNtXVx4MWJbMDszN20iJShzZWxmLmtvLGxlbihzZWxmLmZsKSxsZW4oc2VsZi5hZGEpLGxlbihzZWxmLmNwKSksIGVuZD0nICcpO3N5cy5zdGRvdXQuZmx1c2goKQoJCWV4Y2VwdDoKCQkJc2VsZi5tYWluKGZsKQoKY2xhc3MgY3JhY2t0dGw6Cglvcy5zeXN0ZW0oImNsZWFyIikKCWJhbm5lcigpCglkZWYgX19pbml0X18oc2VsZixpc2lmaWxlKToKCQlzZWxmLmFkYT1bXQoJCXNlbGYuY3A9W10KCQlzZWxmLmtvPTAKCQlwcmludCgoaysiXG5bIitwKyLigKIiK2srIl0iK3ArIiBDcmFjayBXaXRoIFBhc3MgRGVmYXVsdC9NYW51YWwgW2QvbV0iKSkKCQl3aGlsZSBUcnVlOgoJCQlmPWlucHV0KGsrIlsiK3ArIuKAoiIraysiXSIrcCsiIENob29zZSA6ICIpCgkJCWlmIGY9PSIiOmNvbnRpbnVlCgkJCWVsaWYgZj09Im0iOgoJCQkJdHJ5OgoJCQkJCXdoaWxlIFRydWU6CgkJCQkJCXRyeToKCQkJCQkJCXNlbGYuYXBrPWlzaWZpbGUKCQkJCQkJCXNlbGYuZnM9b3BlbihzZWxmLmFwaykucmVhZCgpLnNwbGl0bGluZXMoKQoJCQkJCQkJYnJlYWsKCQkJCQkJZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgoJCQkJCQkJcHJpbnQoKCIgICAlcyIlZSkpCgkJCQkJCQljb250aW51ZQoJCQkJCXNlbGYuZmw9W10KCQkJCQlmb3IgaSBpbiBzZWxmLmZzOgoJCQkJCQl0cnk6CgkJCQkJCQlzZWxmLmZsLmFwcGVuZCh7ImlkIjppLnNwbGl0KCI8PT4iKVswXX0pCgkJCQkJCWV4Y2VwdDpjb250aW51ZQoJCQkJZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgoJCQkJCXByaW50KCgiICAgJXMiJWUpKQoJCQkJCWNvbnRpbnVlCgkJCQlwcmludCgoaysiWyIrcCsi4oCiIitrKyJdIitwKyIgRXhhbXBsZSA6IHNheWFuZyxiaXNtaWxsYWgsMTIzNDU2IikpCgkJCQlzZWxmLnB3bGlzdCgpCgkJCQlicmVhawoJCQllbGlmIGY9PSJkIjoKCQkJCXRyeToKCQkJCQl3aGlsZSBUcnVlOgoJCQkJCQl0cnk6CgkJCQkJCQlzZWxmLmFwaz1pc2lmaWxlCgkJCQkJCQlzZWxmLmZzPW9wZW4oc2VsZi5hcGspLnJlYWQoKS5zcGxpdGxpbmVzKCkKCQkJCQkJCWJyZWFrCgkJCQkJCWV4Y2VwdCBFeGNlcHRpb24gYXMgZToKCQkJCQkJCXByaW50KCgiICAgJXMiJWUpKQoJCQkJCQkJY29udGludWUKCQkJCQlzZWxmLmZsPVtdCgkJCQkJZm9yIGkgaW4gc2VsZi5mczoKCQkJCQkJdHJ5OgoJCQkJCQkJc2VsZi5mbC5hcHBlbmQoeyJpZCI6aS5zcGxpdCgiPD0+IilbMF0sInB3IjpnZW5lcmF0ZShpLnNwbGl0KCI8PT4iKVsxXSl9KQoJCQkJCQlleGNlcHQ6Y29udGludWUKCQkJCWV4Y2VwdCBFeGNlcHRpb24gYXMgZToKCQkJCQlwcmludCgoIiAgICVzIiVlKSkKCQkJCXByaW50KChrKyJcblsiK3ArIuKAoiIraysiXSIrcCsiIENyYWNrIFN0YXJ0ZWQuLi4iK2srIlxuWyIrcCsi4oCiIitrKyJdIitwKyIgQWNjb3VudCBbS2FjaGktT0tdIFNhdmVkIHRvIDogS2FjaGktT0sudHh0IitrKyJcblsiK3ArIuKAoiIraysiXSIrcCsiIEFjY291bnQgW0thY2hpLUNQXSBTYXZlZCB0byA6IEthY2hpLUNQLnR4dFxuIikpCgkJCQlUaHJlYWRQb29sKDM1KS5tYXAoc2VsZi5tYWluLHNlbGYuZmwpCgkJCQlvcy5yZW1vdmUoc2VsZi5hcGspCgkJCQlleGl0KCkKCQkJCWJyZWFrCglkZWYgcHdsaXN0KHNlbGYpOgoJCXNlbGYucHc9aW5wdXQoaysiWyIrcCsi4oCiIitrKyJdIitwKyIgUGFzc3dvcmQgTGlzdCA6ICIpLnNwbGl0KCIsIikKCQlpZiBsZW4oc2VsZi5wdykgPT0wOgoJCQlzZWxmLnB3bGlzdCgpCgkJZWxzZToKCQkJZm9yIGkgaW4gc2VsZi5mbDoKCQkJCWkudXBkYXRlKHsicHciOnNlbGYucHd9KQoJCQlwcmludCgoaysiXG5bIitwKyLigKIiK2srIl0iK3ArIiBDcmFjayBTdGFydGVkLi4uIitrKyJcblsiK3ArIuKAoiIraysiXSIrcCsiIEFjY291bnQgW0thY2hpLU9LXSBTYXZlZCB0byA6IEthY2hpLU9LLnR4dCIraysiXG5bIitwKyLigKIiK2srIl0iK3ArIiBBY2NvdW50IFtLYWNoaS1DUF0gU2F2ZWQgdG8gOiBLYWNoaS1DUC50eHRcbiIpKQoJCQlUaHJlYWRQb29sKDMwKS5tYXAoc2VsZi5tYWluLHNlbGYuZmwpCgkJCW9zLnJlbW92ZShzZWxmLmFwaykKCQkJZXhpdCgpCglkZWYgbWFpbihzZWxmLGZsKToKCQl0cnk6CgkJCWZvciBpIGluIGZsLmdldCgicHciKToKCQkJCWxvZz1tYmFzaWMoZmwuZ2V0KCJpZCIpLAoJCQkJCWksImh0dHBzOi8vbWJhc2ljLmZhY2Vib29rLmNvbSIpCgkJCQlpZiBsb2cuZ2V0KCJzdGF0dXMiKT09ImNwIjoKCQkJCQl0cnk6CgkJCQkJCWtlPXJlcXVlc3RzLmdldCgiaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vIitmbC5nZXQoImlkIikrIj9hY2Nlc3NfdG9rZW49IitvcGVuKCJsb2dpbi50eHQiLCJyIikucmVhZCgpKQoJCQkJCQl0dD1qc29uLmxvYWRzKGtlLnRleHQpCgkJCQkJCXR0bD10dFsiYmlydGhkYXkiXQoJCQkJCWV4Y2VwdDpwYXNzCgkJCQkJcHJpbnQoKCJcclx4MWJbMDszM21bXHgxYlswOzM3bUthY2hpLUNQXHgxYlswOzMzbV0gJXMg4oCiICVzIOKAoiAlc1x4MWJbMG0gICAiJShmbC5nZXQoImlkIiksaSxzdHIodHRsKSkpKQoJCQkJCXNlbGYuY3AuYXBwZW5kKCIlcyDigKIgJXMiJShmbC5nZXQoImlkIiksaSkpCgkJCQkJb3BlbigiS2FjaGktQ1AudHh0IiwiYSsiKS53cml0ZSgKCQkJCQkJIiVzIOKAoiAlcyDigKIgJXNcbiIlKGZsLmdldCgiaWQiKSxpLHN0cih0dGwpKSkKCQkJCQlicmVhawoJCQkJZWxpZiBsb2cuZ2V0KCJzdGF0dXMiKT09InN1Y2Nlc3MiOgoJCQkJCXByaW50KCgiXHJceDFiWzA7MzJtW1x4MWJbMDszN21LYWNoaS1PS1x4MWJbMDszMm1dICVzIOKAoiAlcyAgICAgICAgICAgICAgICIlKGZsLmdldCgiaWQiKSxpKSkpCgkJCQkJc2VsZi5hZGEuYXBwZW5kKCIlcyDigKIgJXMiJShmbC5nZXQoImlkIiksaSkpCgkJCQkJaWYgZmwuZ2V0KCJpZCIpIGluIG9wZW4oIkthY2hpLU9LLnR4dCIpLnJlYWQoKToKCQkJCQkJYnJlYWsKCQkJCQllbHNlOgoJCQkJCQlvcGVuKCJLYWNoaS1PSy50eHQiLCJhKyIpLndyaXRlKAoJCQkJCQkiJXMg4oCiICVzXG4iJShmbC5nZXQoImlkIiksaSkpCgkJCQkJYnJlYWsKCQkJCWVsc2U6Y29udGludWUKCQkJCQkKCQkJc2VsZi5rbys9MQoJCQlwcmludCgiXHJceDFiWzA7MzNtW1x4MWJbMDszN21DcmFja1x4MWJbMDszM21dXHgxYlswOzM3bSAlcy8lcyBceDFiWzA7MzJtW1x4MWJbMDszN21LYWNoaS1PSyA6ICVzXHgxYlswOzMybV0gXHgxYlswOzMzbVtceDFiWzA7MzdtS2FjaGktQ1AgOiAlc1x4MWJbMDszM21dXHgxYlswOzM3bSIlKHNlbGYua28sbGVuKHNlbGYuZmwpLGxlbihzZWxmLmFkYSksbGVuKHNlbGYuY3ApKSwgZW5kPScgJyk7c3lzLnN0ZG91dC5mbHVzaCgpCgkJZXhjZXB0OgoJCQlzZWxmLm1haW4oZmwpCgojIyMgUkVTVUxUICMjIwoKZGVmIHJlc3VsdHMoRGFwdW50YSxLcmFoa3JhaCk6CiAgICAgICAgaWYgbGVuKERhcHVudGEpICE9MDoKICAgICAgICAgICAgICAgIHByaW50KCgiW09LXSA6ICIrc3RyKGxlbihEYXB1bnRhKSkpKQogICAgICAgIGlmIGxlbihLcmFoa3JhaCkgIT0wOgogICAgICAgICAgICAgICAgcHJpbnQoKCJbQ1BdIDogIitzdHIobGVuKEtyYWhrcmFoKSkpKQogICAgICAgIGlmIGxlbihEYXB1bnRhKSA9PTAgYW5kIGxlbihLcmFoa3JhaCkgPT0wOgogICAgICAgICAgICAgICAgcHJpbnQoIlxuIikKICAgICAgICAgICAgICAgIHByaW50KChrKyJbIitwKyIhIitrKyJdIitwKyIgTm8gUmVzdWx0IEZvdW5kIikpCgpkZWYgcmVzcygpOgogICAgb3Muc3lzdGVtKCJjbGVhciIpCiAgICBiYW5uZXIoKQogICAgcHJpbnQoKGsrIlxuWyAiK3ArIlJlc3VsdCBDcmFjayIraysiIF0iK3ApKQogICAgcHJpbnQoKGsrIlxuWyAiK3ArIk9LIitrKyIgXSIrcCkpCiAgICB0cnk6CiAgICAgICAgb3Muc3lzdGVtKCJjYXQgS2FjaGktT0sudHh0IikKICAgIGV4Y2VwdCBJT0Vycm9yOgogICAgICAgIHByaW50KChrKyJbIitwKyIhIitrKyJdIitwKyIgTm8gUmVzdWx0IEZvdW5kIikpCiAgICBwcmludCgoaysiXG5bICIrcCsiQ1AiK2srIiBdIitwKSkKICAgIHRyeToKICAgICAgICBvcy5zeXN0ZW0oImNhdCBLYWNoaS1DUC50eHQiKQogICAgZXhjZXB0IElPRXJyb3I6CiAgICAgICAgcHJpbnQoKGsrIlsiK3ArIiEiK2srIl0iK3ArIiBObyBSZXN1bHQgRm91bmQiKSkKICAgIGlucHV0KGsrIlxuWyAiK3ArIkJhY2siK2srIiBdIitwKQogICAgbWVudSgpCgppZiBfX25hbWVfXz09Il9fbWFpbl9fIjoKCW9zLnN5c3RlbSgiZ2l0IHB1bGwiKQoJbWVudSgpCg=="))